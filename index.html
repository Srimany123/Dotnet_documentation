<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TaskHub ‚Äî .NET (Docs & Logs)</title>
  <meta name="description" content="Event-driven TaskHub (.NET, Redis, SQL, Grafana) deep dive with PDF and logs snapshot." />

  <!-- Loosened CSP for iframes (PDF.js, Grafana snapshot).
       We don't allow third-party scripts on THIS page, only frames. -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' data: https:;
                 frame-src https://snapshots.raintank.io https://mozilla.github.io https:;
                 connect-src https:;
                 script-src 'self' 'unsafe-inline';
                 font-src 'self' https: data:;">

  <style>
    :root {
      --bg:#0b0d10;
      --fg:#e8eef2;
      --muted:#8fa3ad;
      --card:#11161c;
      --link:#7cc1ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{padding:16px 20px;background:linear-gradient(180deg,#0f141a,#0b0d10);border-bottom:1px solid #1d2630}
    h1{margin:0;font-size:20px}
    main{padding:16px;display:flex;flex-direction:column;gap:40px}
    h2{margin-top:0;color:var(--link)}
    .viewer{background:var(--card);border:1px solid #1d2630;border-radius:12px;overflow:hidden}
    .bar{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid #1d2630;color:var(--muted);flex-wrap:wrap}
    .bar a{color:var(--link);text-decoration:none}
    .bar a:hover{text-decoration:underline}
    .frame-wrap{height:calc(100vh - 200px)}
    iframe,embed,object{width:100%;height:100%;border:0;display:block}
    footer{padding:12px 20px;color:var(--muted);font-size:13px;border-top:1px solid #1d2630;text-align:center}
    .hint{margin-left:auto;font-size:13px;color:var(--muted)}
    @media (max-width:768px){
      .frame-wrap{height:70vh}
    }
  </style>
</head>
<body>
  <header><h1>TaskHub ‚Äî .NET Showcase</h1></header>
  <main>
    <!-- PDF Documentation -->
    <section>
      <h2>üìÑ Project Documentation</h2>
      <div class="viewer">
        <div class="bar">
          <span>Viewing: <strong>.NET ‚Ä¢ Monitoring ‚Ä¢ Logging</strong></span>
          <span>‚Ä¢</span>
          <a href="assets/Dotnet.pdf" download>Download</a>
          <span>‚Ä¢</span>
          <a id="open-mobile" href="assets/Dotnet.pdf" target="_blank" rel="noopener">Open on mobile</a>
          <span class="hint" id="pdf-hint"></span>
        </div>
        <div class="frame-wrap">
          <!-- Start with native inline PDF. We'll swap to PDF.js on mobile/iOS. -->
          <iframe
            id="pdf-frame"
            title="TaskHub deep dive PDF"
            src="assets/Dotnet.pdf#view=FitH&zoom=page-width&toolbar=1&navpanes=0"
            loading="eager">
          </iframe>
          <!-- Fallback if neither inline nor PDF.js can load -->
          <div id="pdf-fallback" style="display:none;padding:14px;color:var(--muted);text-align:center">
            <p>‚ö†Ô∏è Inline PDF viewer isn‚Äôt available. Use the buttons above to open the PDF.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Grafana Logs Snapshot -->
    <section>
      <h2>üìä Logs & Metrics Snapshot</h2>
      <div class="viewer">
        <div class="bar">
          <span>Grafana Logs (Snapshot)</span>
          <span>‚Ä¢</span>
          <a href="https://snapshots.raintank.io/dashboard/snapshot/Fb6gxiPrOntaQuJED1sBHc8zcrIlYh0a?orgId=0"
             target="_blank" rel="noopener">Open Fullscreen</a>
        </div>
        <div class="frame-wrap">
          <iframe
            title="Grafana Logs Snapshot"
            src="https://snapshots.raintank.io/dashboard/snapshot/Fb6gxiPrOntaQuJED1sBHc8zcrIlYh0a?orgId=0&kiosk"
            loading="lazy"
            sandbox="allow-scripts allow-same-origin allow-popups"
            referrerpolicy="no-referrer"
            onload="this.dataset.loaded=1">
          </iframe>
          <div id="snapshot-fallback" style="display:none;padding:14px;color:var(--muted);text-align:center">
            <p>‚ö†Ô∏è Snapshot embedding blocked. View instead:</p>
            <p>
              <a href="assets/logs-snapshot.png" target="_blank" rel="noopener">View Screenshot</a> ¬∑
              <a href="https://snapshots.raintank.io/dashboard/snapshot/Fb6gxiPrOntaQuJED1sBHc8zcrIlYh0a?orgId=0"
                 target="_blank" rel="noopener">Open Live Snapshot</a>
            </p>
            <img src="assets/logs-snapshot.png" alt="Grafana logs snapshot" style="max-width:100%;border-radius:8px;border:1px solid #1d2630"/>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>¬© <span id="y"></span> Sriman ‚Ä¢ .NET ‚Ä¢ C# ‚Ä¢ Redis ‚Ä¢ SQL ‚Ä¢ Grafana/Loki</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // ----- Grafana snapshot fallback if the iframe never loads
    (function(){
      const frame = document.querySelector('iframe[title="Grafana Logs Snapshot"]');
      const fallback = document.getElementById('snapshot-fallback');
      if(!frame) return;
      const t = setTimeout(() => {
        if(!frame.dataset.loaded){
          fallback.style.display='block';
          frame.style.display='none';
        }
      }, 4000);
      frame.addEventListener('load', () => clearTimeout(t));
    })();

    // ----- Mobile-friendly PDF viewer
    (function(){
      const pdfFrame = document.getElementById('pdf-frame');
      const openMobile = document.getElementById('open-mobile');
      const hint = document.getElementById('pdf-hint');
      const fallback = document.getElementById('pdf-fallback');

      const isSmall = window.matchMedia('(max-width: 768px)').matches;
      const ua = navigator.userAgent || '';
      const isiOS = /iPad|iPhone|iPod/.test(ua);
      const isSafari = /^((?!chrome|android).)*safari/i.test(ua);

      // Use Mozilla PDF.js viewer on small screens or iOS/Safari where inline PDFs are flaky.
      if (isSmall || isiOS || isSafari) {
        const pdfUrl = new URL('assets/Dotnet.pdf', location.href).href;
        const pdfjsUrl = 'https://mozilla.github.io/pdf.js/web/viewer.html?file=' + encodeURIComponent(pdfUrl) + '#zoom=page-width';
        pdfFrame.src = pdfjsUrl;
        hint.textContent = 'Optimized mobile viewer (PDF.js).';
      } else {
        hint.textContent = 'Using native inline PDF viewer.';
      }

      // Safety net: if PDF frame doesn‚Äôt load in 5s, show fallback.
      let loaded = false;
      const timer = setTimeout(() => {
        if (!loaded) {
          fallback.style.display = 'block';
          pdfFrame.style.display = 'none';
        }
      }, 5000);
      pdfFrame.addEventListener('load', () => { loaded = true; clearTimeout(timer); });
    })();
  </script>
</body>
</html>
